# NFT拍卖系统接口测试报告

## 测试环境信息
- **测试时间**: _______________
- **测试网络**: _______________
- **测试工具**: Remix IDE
- **合约版本**: v1.0

## 1. NftAuctionFactory 合约测试

### 1.1 构造函数测试
**接口**: `constructor(address _ccipRouter, address _auctionImplementation)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常部署 | _ccipRouter: 0x0BF3dE8c5D3e8A2B34D2BEeB17ABfCeBaf363A59<br>_auctionImplementation: [实现合约地址] | 部署成功，admin设置正确 | | ⬜ |
| 错误CCIP地址 | _ccipRouter: 0x0000000000000000000000000000000000000000<br>_auctionImplementation: [实现合约地址] | 部署成功（允许） | | ⬜ |

### 1.2 mintNFT 测试
**接口**: `mintNFT(address to, string memory uri) returns (uint256)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常铸造 | to: [用户地址]<br>uri: "https://example.com/nft/1" | 铸造成功，返回tokenId | | ⬜ |
| 非owner调用 | to: [用户地址]<br>uri: "https://example.com/nft/1" | 调用失败 | | ⬜ |
| 空URI | to: [用户地址]<br>uri: "" | 铸造成功 | | ⬜ |

### 1.3 createAuction 测试
**接口**: `createAuction(address _nftAddress, uint256 _tokenId, uint256 _during, uint256 _startPrice) returns (address)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常创建 | _nftAddress: [工厂地址]<br>_tokenId: 1<br>_during: 3600<br>_startPrice: 10000000000000000 | 创建成功，返回代理地址 | | ⬜ |
| 非admin调用 | 同上 | 调用失败 | | ⬜ |
| 起拍价过低 | _startPrice: 0 | 调用失败 | | ⬜ |
| 时间过短 | _during: 5 | 调用失败 | | ⬜ |

### 1.4 createAuctionWithNewNFT 测试
**接口**: `createAuctionWithNewNFT(string memory uri, uint256 _during, uint256 _startPrice) returns (address, uint256)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常创建 | uri: "https://example.com/nft/2"<br>_during: 3600<br>_startPrice: 10000000000000000 | 创建成功，返回代理地址和tokenId | | ⬜ |

### 1.5 getAllAuctions 测试
**接口**: `getAllAuctions() returns (TestNftAuction[] memory)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 无拍卖 | 无 | 返回空数组 | | ⬜ |
| 有拍卖 | 无 | 返回拍卖地址数组 | | ⬜ |

### 1.6 getAuctionCount 测试
**接口**: `getAuctionCount() returns (uint256)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 无拍卖 | 无 | 返回0 | | ⬜ |
| 有拍卖 | 无 | 返回拍卖数量 | | ⬜ |

## 2. TestNftAuction 合约测试

### 2.1 initialize 测试
**接口**: `initialize(address _seller, address _ccipRouter)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常初始化 | _seller: [卖家地址]<br>_ccipRouter: 0x0BF3dE8c5D3e8A2B34D2BEeB17ABfCeBaf363A59 | 初始化成功 | | ⬜ |
| 重复初始化 | 同上 | 调用失败 | | ⬜ |

### 2.2 setAuctionParameters 测试
**接口**: `setAuctionParameters(address _nftAddress, uint256 _tokenId, uint256 _during, uint256 _startPrice)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常设置 | _nftAddress: [NFT地址]<br>_tokenId: 1<br>_during: 3600<br>_startPrice: 10000000000000000 | 设置成功 | | ⬜ |
| 非admin调用 | 同上 | 调用失败 | | ⬜ |
| 拍卖已开始 | 同上 | 调用失败 | | ⬜ |

### 2.3 startAuction 测试
**接口**: `startAuction()`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常开始 | 无 | 拍卖开始 | | ⬜ |
| 非admin调用 | 无 | 调用失败 | | ⬜ |
| 参数未设置 | 无 | 调用失败 | | ⬜ |
| 重复开始 | 无 | 调用失败 | | ⬜ |

### 2.4 bid 测试
**接口**: `bid(address _nftAddress, uint256 _amount)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| ETH竞拍 | _nftAddress: 0x0000000000000000000000000000000000000000<br>_amount: 20000000000000000<br>value: 20000000000000000 | 竞拍成功 | | ⬜ |
| 拍卖未开始 | 同上 | 调用失败 | | ⬜ |
| 拍卖已结束 | 同上 | 调用失败 | | ⬜ |
| 出价过低 | _amount: 5000000000000000 | 调用失败 | | ⬜ |
| 出价相同 | _amount: 10000000000000000 | 调用失败 | | ⬜ |

### 2.5 endAuction 测试
**接口**: `endAuction()`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常结束 | 无 | 拍卖结束，NFT转移 | | ⬜ |
| 拍卖未到期 | 无 | 调用失败 | | ⬜ |
| 重复结束 | 无 | 调用失败 | | ⬜ |
| 无出价者 | 无 | NFT退还卖家 | | ⬜ |

### 2.6 crossChainBid 测试
**接口**: `crossChainBid(uint64 destinationChainId, address _nftAddress, uint256 _amount)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常跨链 | destinationChainId: 11155111<br>_nftAddress: 0x0000000000000000000000000000000000000000<br>_amount: 10000000000000000 | 跨链消息发送 | | ⬜ |
| 不支持链 | destinationChainId: 999999 | 调用失败 | | ⬜ |
| 金额为0 | _amount: 0 | 调用失败 | | ⬜ |

### 2.7 addSupportedChain 测试
**接口**: `addSupportedChain(uint64 chainId)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常添加 | chainId: 11155111 | 链添加成功 | | ⬜ |
| 非admin调用 | chainId: 11155111 | 调用失败 | | ⬜ |

### 2.8 setPriceFeed 测试
**接口**: `setPriceFeed(address _nftAddress, address _priceFeed)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常设置 | _nftAddress: [代币地址]<br>_priceFeed: [预言机地址] | 设置成功 | | ⬜ |

### 2.9 getPrice 测试
**接口**: `getPrice(address _nftAddress) returns (int)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 有预言机 | _nftAddress: [代币地址] | 返回价格 | | ⬜ |
| 无预言机 | _nftAddress: 0x0000000000000000000000000000000000000000 | 返回1 | | ⬜ |

## 3. TestNftAuctionV2 合约测试

### 3.1 testHello 测试
**接口**: `testHello() returns (string memory)`

| 测试用例 | 参数 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 正常调用 | 无 | 返回"Hello, World!" | | ⬜ |

## 4. 合约升级测试

### 4.1 升级流程测试
| 测试用例 | 步骤 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 数据保持 | 1. 创建拍卖<br>2. 进行竞拍<br>3. 升级合约<br>4. 验证数据 | 数据完整保持 | | ⬜ |
| 功能可用 | 1. 升级后调用新功能 | 新功能正常 | | ⬜ |

## 5. 集成测试

### 5.1 完整拍卖流程
| 测试用例 | 步骤 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 标准流程 | 1. 部署合约<br>2. 铸造NFT<br>3. 创建拍卖<br>4. 开始拍卖<br>5. 参与竞拍<br>6. 结束拍卖 | 流程完整执行 | | ⬜ |

### 5.2 多用户竞拍
| 测试用例 | 步骤 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 竞拍场景 | 1. 用户A出价<br>2. 用户B出价<br>3. 用户A再次出价 | 最高出价者更新 | | ⬜ |

## 6. 性能测试

### 6.1 Gas消耗测试
| 操作 | Gas消耗 | 预期范围 | 实际结果 | 状态 |
|------|---------|----------|----------|------|
| 部署工厂合约 | | < 5000000 | | ⬜ |
| 创建拍卖 | | < 2000000 | | ⬜ |
| 竞拍 | | < 150000 | | ⬜ |

## 7. 安全测试

### 7.1 权限测试
| 测试用例 | 操作 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 非admin创建拍卖 | 调用createAuction | 失败 | | ⬜ |
| 非admin升级合约 | 调用升级 | 失败 | | ⬜ |

### 7.2 重入攻击测试
| 测试用例 | 操作 | 预期结果 | 实际结果 | 状态 |
|---------|------|----------|----------|------|
| 恶意合约竞拍 | 使用恶意合约调用bid | 正常处理 | | ⬜ |

## 8. 测试总结

### 8.1 测试统计
- **总测试用例数**: ___
- **通过用例数**: ___
- **失败用例数**: ___
- **通过率**: ___%

### 8.2 发现的问题
1. ________________________________
2. ________________________________
3. ________________________________

### 8.3 改进建议
1. ________________________________
2. ________________________________
3. ________________________________

### 8.4 测试结论
□ 通过所有测试，可以部署到生产环境
□ 部分测试失败，需要修复后重新测试
□ 测试失败较多，需要重新设计

---

**测试人员**: _______________  
**测试日期**: _______________  
**审核人员**: _______________  
**审核日期**: _______________
